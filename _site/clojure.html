<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
				<meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Clojure Collision Logic</title>
        <link rel="stylesheet" href="/lambda-up/css/light-table.css">
				<!-- Bootstrap styles -->
				<!-- <link href="/lambda-up/assets/themes/bootstrap-3/bootstrap/css/bootstrap.min.css" rel="stylesheet"> -->
				<!--	<link href="/lambda-up/assets/themes/bootstrap-3/css/style.css?body=1" rel="stylesheet" type="text/css" media="all"> -->


    </head>
    <body>
				<div id="wrap">
						<div class="container">
								<div class="row">


	<main>

    	<h1>Clojure Collision Logic</h1>

    	<p>Read <a href="http://www.reddit.com">Reddit</a> for all of your reddit needs.</p>

<h2>My First Section</h2>

<p>Here is an example of the underlying collision logic. </p>

<div class="highlight"><pre><code class="language-clojure" data-lang="clojure"><span class="c1">;; collision logic --- now the input balls are the mutable atoms </span>
<span class="p">(</span><span class="kd">defn </span><span class="nv">collide!</span> 
  <span class="p">([</span><span class="nv">ball</span><span class="p">]</span>
   <span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">this-ball</span> <span class="nv">ball</span><span class="p">]</span>
     <span class="p">(</span><span class="nb">doseq </span><span class="p">[</span><span class="nv">that-ball</span> <span class="p">(</span><span class="nb">disj </span><span class="o">@</span><span class="nv">balls</span> <span class="nv">this-ball</span><span class="p">)]</span>
       <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nf">overlapping?</span> <span class="o">@</span><span class="nv">this-ball</span> <span class="o">@</span><span class="nv">that-ball</span><span class="p">)</span>
         <span class="p">(</span><span class="nf">collide!</span> <span class="nv">this-ball</span> <span class="nv">that-ball</span><span class="p">)))))</span>
  <span class="p">([</span><span class="nv">this-ball</span> <span class="nv">that-ball</span><span class="p">]</span>
   <span class="c1">;; compute new velocities from impulse physics</span>
   <span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">this-new-vel</span> 
         <span class="p">(</span><span class="nf">Point.</span> <span class="p">(</span><span class="nb">+ </span><span class="p">(</span><span class="ss">:x</span> <span class="p">(</span><span class="ss">:vel</span> <span class="o">@</span><span class="nv">this-ball</span><span class="p">))</span>
                    <span class="p">(</span><span class="nb">/ </span><span class="p">(</span><span class="ss">:x</span> <span class="p">(</span><span class="nf">get-impulse</span> <span class="o">@</span><span class="nv">this-ball</span> <span class="o">@</span><span class="nv">that-ball</span><span class="p">))</span> <span class="p">(</span><span class="nf">get-mass</span> <span class="o">@</span><span class="nv">this-ball</span><span class="p">)))</span>
                 <span class="p">(</span><span class="nb">+ </span><span class="p">(</span><span class="ss">:y</span> <span class="p">(</span><span class="ss">:vel</span> <span class="o">@</span><span class="nv">this-ball</span><span class="p">))</span>
                    <span class="p">(</span><span class="nb">/ </span><span class="p">(</span><span class="ss">:y</span> <span class="p">(</span><span class="nf">get-impulse</span> <span class="o">@</span><span class="nv">this-ball</span> <span class="o">@</span><span class="nv">that-ball</span><span class="p">))</span> <span class="p">(</span><span class="nf">get-mass</span> <span class="o">@</span><span class="nv">this-ball</span><span class="p">))))</span>
         <span class="nv">that-new-vel</span>
         <span class="p">(</span><span class="nf">Point.</span> <span class="p">(</span><span class="nb">+ </span><span class="p">(</span><span class="ss">:x</span> <span class="p">(</span><span class="ss">:vel</span> <span class="o">@</span><span class="nv">that-ball</span><span class="p">))</span>
                    <span class="p">(</span><span class="nb">/ </span><span class="p">(</span><span class="ss">:x</span> <span class="p">(</span><span class="nf">get-impulse</span> <span class="o">@</span><span class="nv">that-ball</span> <span class="o">@</span><span class="nv">this-ball</span><span class="p">))</span> <span class="p">(</span><span class="nf">get-mass</span> <span class="o">@</span><span class="nv">that-ball</span><span class="p">)))</span>
                 <span class="p">(</span><span class="nb">+ </span><span class="p">(</span><span class="ss">:y</span> <span class="p">(</span><span class="ss">:vel</span> <span class="o">@</span><span class="nv">that-ball</span><span class="p">))</span>
                    <span class="p">(</span><span class="nb">/ </span><span class="p">(</span><span class="ss">:y</span> <span class="p">(</span><span class="nf">get-impulse</span> <span class="o">@</span><span class="nv">that-ball</span> <span class="o">@</span><span class="nv">this-ball</span><span class="p">))</span> <span class="p">(</span><span class="nf">get-mass</span> <span class="o">@</span><span class="nv">that-ball</span><span class="p">))))</span>
         <span class="nv">tstar</span> <span class="p">(</span><span class="nf">get-collision-time</span> <span class="o">@</span><span class="nv">this-ball</span> <span class="o">@</span><span class="nv">that-ball</span><span class="p">)]</span>
     <span class="c1">;; rewind time at old velocity to negative time tstar, and redo time at new velocity</span>
     <span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">this-new-pos</span>
           <span class="p">(</span><span class="nf">Point.</span> <span class="p">(</span><span class="nb">+ </span><span class="p">(</span><span class="ss">:x</span> <span class="p">(</span><span class="ss">:pos</span> <span class="o">@</span><span class="nv">this-ball</span><span class="p">))</span> 
                      <span class="p">(</span><span class="nb">* </span><span class="nv">tstar</span> <span class="p">(</span><span class="ss">:x</span> <span class="p">(</span><span class="ss">:vel</span> <span class="o">@</span><span class="nv">this-ball</span><span class="p">)))</span>
                      <span class="p">(</span><span class="nf">flip-sign</span> <span class="p">(</span><span class="nb">* </span><span class="nv">nudge</span> <span class="nv">tstar</span> <span class="p">(</span><span class="ss">:x</span> <span class="nv">this-new-vel</span><span class="p">))))</span>
                   <span class="p">(</span><span class="nb">+ </span><span class="p">(</span><span class="ss">:y</span> <span class="p">(</span><span class="ss">:pos</span> <span class="o">@</span><span class="nv">this-ball</span><span class="p">))</span> 
                      <span class="p">(</span><span class="nb">* </span><span class="nv">tstar</span> <span class="p">(</span><span class="ss">:y</span> <span class="p">(</span><span class="ss">:vel</span> <span class="o">@</span><span class="nv">this-ball</span><span class="p">)))</span>
                      <span class="p">(</span><span class="nf">flip-sign</span> <span class="p">(</span><span class="nb">* </span><span class="nv">nudge</span> <span class="nv">tstar</span> <span class="p">(</span><span class="ss">:y</span> <span class="nv">this-new-vel</span><span class="p">)))))</span>
           <span class="nv">that-new-pos</span>
           <span class="p">(</span><span class="nf">Point.</span> <span class="p">(</span><span class="nb">+ </span><span class="p">(</span><span class="ss">:x</span> <span class="p">(</span><span class="ss">:pos</span> <span class="o">@</span><span class="nv">that-ball</span><span class="p">))</span> 
                      <span class="p">(</span><span class="nb">* </span><span class="nv">tstar</span> <span class="p">(</span><span class="ss">:x</span> <span class="p">(</span><span class="ss">:vel</span> <span class="o">@</span><span class="nv">that-ball</span><span class="p">)))</span>
                      <span class="p">(</span><span class="nf">flip-sign</span> <span class="p">(</span><span class="nb">* </span><span class="nv">nudge</span> <span class="nv">tstar</span> <span class="p">(</span><span class="ss">:x</span> <span class="nv">that-new-vel</span><span class="p">))))</span>
                   <span class="p">(</span><span class="nb">+ </span><span class="p">(</span><span class="ss">:y</span> <span class="p">(</span><span class="ss">:pos</span> <span class="o">@</span><span class="nv">that-ball</span><span class="p">))</span> 
                      <span class="p">(</span><span class="nb">* </span><span class="nv">tstar</span> <span class="p">(</span><span class="ss">:y</span> <span class="p">(</span><span class="ss">:vel</span> <span class="o">@</span><span class="nv">that-ball</span><span class="p">)))</span>
                      <span class="p">(</span><span class="nf">flip-sign</span> <span class="p">(</span><span class="nb">* </span><span class="nv">nudge</span> <span class="nv">tstar</span> <span class="p">(</span><span class="ss">:y</span> <span class="nv">that-new-vel</span><span class="p">)))))]</span>

     <span class="p">(</span><span class="nb">doseq </span><span class="p">[]</span>
       <span class="p">(</span><span class="nf">swap!</span> <span class="nv">this-ball</span> <span class="nb">assoc </span><span class="ss">:vel</span> <span class="nv">this-new-vel</span><span class="p">)</span>
       <span class="p">(</span><span class="nf">swap!</span> <span class="nv">that-ball</span> <span class="nb">assoc </span><span class="ss">:vel</span> <span class="nv">that-new-vel</span><span class="p">)</span>
       <span class="p">(</span><span class="nf">swap!</span> <span class="nv">this-ball</span> <span class="nb">assoc </span><span class="ss">:pos</span> <span class="nv">this-new-pos</span><span class="p">)</span>
       <span class="p">(</span><span class="nf">swap!</span> <span class="nv">that-ball</span> <span class="nb">assoc </span><span class="ss">:pos</span> <span class="nv">that-new-pos</span><span class="p">))))))</span></code></pre></div>

<p>This is quite different from the corresponding implementation in Java.
In that paradigm, we had various mutations. The atomic, single nature
of a state change was not as easily apparent. </p>

	</main>


</div>
</div>
</div>
</body>
</html>

